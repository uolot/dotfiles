# vim: ft=sway
set $mod Mod4
set $mod2 Alt
set $rofi wofi

xwayland enable
for_window [shell="xwayland"] title_format "%title [XWayland]"

font pango:Ubuntu Medium 12

gaps inner 8
gaps outer 0
smart_gaps off
smart_borders gaps
default_border pixel 3
titlebar_padding 15 3

# set wallpaper
output "*" background $(fd . $HOME/Pictures/Wallpapers/ -e jpg -e jpeg -e png | shuf -n 1) fill

# outputs
# inline contents of outputs config file, because display rotation is ignored when including

# LAPTOP ONLY - DELL XPS
# include "./outputs/dell-xps-only"

# LAPTOP ONLY - THINKPAD X1CARBON GEN2
# include "./outputs/thinkpad-x1c-gen2"

# HOME OFFICE CPH - DELL XPS + BENQ MONITOR - VERTICAL ARRANGEMENT
# include "./outputs/homeoffice-cph-xps+benq-vertical"

# BENQ
output "BenQ Corporation BenQ EL2870U 26L03402SL0" {
    enable
    mode 3840x2160
    # scale 1.5
    # mode 2560x1440
    scale 1
    pos 0 0
}

# Lyst laptop Dell XPS
output "Sharp Corporation 0x148B 0x00000000" {
    mode 3840x2160
    scale 2
    pos 960 2160
}

output "Ancor Communications Inc ASUS VS247 G7LMTF045350" {
    enable
    mode 1920x1080
    scale 0.7
    # transform 270
}

# assign workspaces to specific outputs
workspace 1 output "Sharp Corporation 0x148B 0x00000000"
workspace 4 output "BenQ Corporation BenQ EL2870U 26L03402SL0"
workspace 10 output "Ancor Communications Inc ASUS VS247 G7LMTF045350"


# inputs

input * {
    xkb_layout pl
    pointer_accel 0
    # Full list: http://sprunge.us/cUZO
    xkb_options shift:both_capslock,compose:paus
}

input "Input device: TPPS/2 IBM TrackPoint" {
    pointer_accel -1
}

input "65261:24673:OLKB_Preonic_Mouse" {
    scroll_factor 1
}

input "12951:50895:ZSA_Technology_Labs_Planck_EZ_Glow_Mouse" {
    scroll_factor 1
}

input "1452:613:Apple_Inc._Magic_Trackpad_2" {

    # input <identifier> accel_profile adaptive|flat
    # Sets the pointer acceleration profile for the specified input device.
    accel_profile adaptive

    # input <identifier> calibration_matrix <6 space-separated floating point values>
    # Sets the calibration matrix.
    #

    # input <identifier> click_method none|button_areas|clickfinger
    # Changes the click method for the specified device.
    click_method clickfinger

    # input <identifier> drag enabled|disabled
    # Enables or disables tap-and-drag for specified input device.
    drag enabled

    # input <identifier> drag_lock enabled|disabled
    # Enables or disables drag lock for specified input device.
    #

    # input <identifier> dwt enabled|disabled
    # Enables or disables disable-while-typing for the specified input device.
    dwt enabled

    # input <identifier> events enabled|disabled|disabled_on_external_mouse|toggle [<toggle-modes>]
    # Enables or disables send_events for specified input device. Disabling send_events disables the input de‚Äê
    # vice.
    #
    # The toggle option cannot be used in the config. If no toggle modes are listed, all supported modes for the
    # device will be toggled through in the order: enabled,     disabled_on_external_mouse, disabled, (loop
    # back). If toggle modes are listed, they will be cycled through, defaulting to the first mode listed if the
    # current mode is not in the list. They will also not be checked to see if they are supported for the device
    # and may fail.
    #

    # input <identifier> left_handed enabled|disabled
    # Enables or disables left handed mode for specified input device.
    #

    # input <identifier> middle_emulation enabled|disabled
    # Enables or disables middle click emulation.
    middle_emulation enabled

    # input <identifier> natural_scroll enabled|disabled
    # Enables or disables natural (inverted) scrolling for the specified input device.
    natural_scroll disabled

    # input <identifier> pointer_accel [<-1|1>]
    # Changes the pointer acceleration for the specified input device.
    pointer_accel 0.2

    # input <identifier> scroll_button disable|button[1-3,8,9]|<event-code-or-name>
    # Sets the button used for scroll_method on_button_down. The button can be given as an event name or code,
    # which can be obtained from libinput debug-events, or as a x11 mouse button (button[1-3,8,9]). If set to
    # disable, it disables the scroll_method on_button_down.
    #

    # input <identifier> scroll_factor <floating point value>
    # Changes the scroll factor for the specified input device. Scroll speed will be scaled by the given value,
    # which must be non-negative.
    scroll_factor 2.5

    # input <identifier> scroll_method none|two_finger|edge|on_button_down
    # Changes the scroll method for the specified input device.
    scroll_method two_finger

    # input <identifier> tap enabled|disabled
    # Enables or disables tap for specified input device.
    tap enabled

    # input <identifier> tap_button_map lrm|lmr
    # Specifies which button mapping to use for tapping. lrm treats 1 finger as left click, 2 fingers as right
    # click, and 3 fingers as middle click. lmr treats 1 finger as left click, 2 fingers as middle click, and 3
    # fingers as right click.
    tap_button_map lrm

}

# start a terminal
bindsym $mod+Return exec alacritty
# start a terminal in last working dir
bindsym $mod+Shift+Return exec alacritty --working-directory $(cat /tmp/workdir 2>/dev/null || pwd)
# start a floating terminal
bindsym $mod+Ctrl+Return exec alacritty -t terminal-floating
for_window [title="^terminal-floating$"] floating enable, resize set width 42 ppt, resize set height 50 ppt, floating enable

for_window [title="^floating$"] floating disable, floating enable

# show time and date
bindsym $mod+t exec $HOME/Bin/showtime.py
for_window [title="^showtime$"] floating enable, border none

bindsym $mod+Shift+t exec $HOME/Bin/timer $(echo -e "5\n20\n30\n25,5" | $rofi --dmenu)
for_window [title="^timer$"] floating enable, sticky enable, border none, move position pointer

# start a webbrowser
bindsym $mod+b exec firefox
# chrome - personal
bindsym $mod+Shift+b exec google-chrome-stable --profile-directory="Profile 1" --enable-features=UseOzonePlatform --ozone-platform=wayland
# chrome - work
bindsym $mod+Ctrl+Shift+b exec google-chrome-stable --profile-directory="Profile 2" --enable-features=UseOzonePlatform --ozone-platform=wayland

# kill focused window
bindsym $mod+Ctrl+q kill
bindsym $mod+Shift+q exec pkill $($rofi -p pkill --dmenu --lines 1)


# launcher
bindsym $mod+Ctrl+space exec $rofi --show run --modi run
bindsym $mod+Shift+space exec $rofi --show drun --modi drun


# change focus
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

# move focused window
bindsym $mod+Shift+h move left 80 px
bindsym $mod+Shift+j move down 80 px
bindsym $mod+Shift+k move up 80 px
bindsym $mod+Shift+l move right 80 px

# change outpu
bindsym $mod2+h focus output left
bindsym $mod2+j focus output down
bindsym $mod2+k focus output up
bindsym $mod2+l focus output right

# resize windows
bindsym $mod+Ctrl+h resize shrink width 25 px or 16 ppt
bindsym $mod+Ctrl+j resize grow height 25 px or 16 ppt
bindsym $mod+Ctrl+k resize shrink height 25 px or 16 ppt
bindsym $mod+Ctrl+l resize grow width 25 px or 16 ppt


# move workspaces
bindsym $mod+Ctrl+Shift+h move workspace to output left
bindsym $mod+Ctrl+Shift+j move workspace to output down
bindsym $mod+Ctrl+Shift+k move workspace to output up
bindsym $mod+Ctrl+Shift+l move workspace to output right

# split in horizontal orientation
bindsym $mod+s split v
# split in vertical orientation
bindsym $mod+v split h

# enter fullscreen mode for the focused container
bindsym $mod+Shift+f fullscreen toggle

# change container layout (stacked, tabbed, toggle split)
bindsym $mod+q layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split
bindsym $mod+c layout toggle splith splitv stacking tabbed

# focus the parent/child container
bindsym $mod+x focus child
bindsym $mod+Shift+x focus parent

# switch to workspace
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9
bindsym $mod+0 workspace number 10

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace number 1
bindsym $mod+Shift+2 move container to workspace number 2
bindsym $mod+Shift+3 move container to workspace number 3
bindsym $mod+Shift+4 move container to workspace number 4
bindsym $mod+Shift+5 move container to workspace number 5
bindsym $mod+Shift+6 move container to workspace number 6
bindsym $mod+Shift+7 move container to workspace number 7
bindsym $mod+Shift+8 move container to workspace number 8
bindsym $mod+Shift+9 move container to workspace number 9
bindsym $mod+Shift+0 move container to workspace number 10

# switch between workspaces
bindsym $mod+Tab workspace next_on_output
bindsym $mod+Shift+Tab workspace prev_on_output
bindsym $mod+Escape workspace prev_on_output
workspace_auto_back_and_forth yes

# Swayr
exec env RUST_BACKTRACE=1 swayrd > /tmp/swayrd.log 2>&1
bindsym $mod2+Tab exec env RUST_BACKTRACE=1 \
    swayr next-window >> /tmp/swayr.log 2>&2
bindsym $mod2+Shift+Tab exec env RUST_BACKTRACE=1 \
    swayr prev-window >> /tmp/swayr.log 2>&2
bindsym $mod2+Escape exec env RUST_BACKTRACE=1 \
    swayr switch-to-urgent-or-lru-window >> /tmp/swayr.log 2>&1
bindsym $mod+Space exec env RUST_BACKTRACE=1 \
    swayr switch-window >> /tmp/swayr.log 2>&1


# rename workspace
bindsym $mod+Shift+n exec $HOME/Bin/sway_rename_workspace

# floating
floating_modifier $mod
bindsym $mod+f floating toggle
bindsym $mod+Shift+s sticky toggle

for_window [title="Firefox - Sharing Indicator"] floating enable
for_window [title="Firefox - Sharing Indicator"] no_focus


# scratchpad
bindsym $mod+Shift+Backspace move scratchpad
bindsym $mod+Backspace scratchpad show

# screenshots
# current output
bindsym $mod+p exec grim -o $(swaymsg --pretty -t get_outputs | awk '/focused/ {print $2}') $($HOME/Bin/make-screenshot-path)
# selected part of the screen
bindsym $mod+Ctrl+p exec grim -g "$(slurp)" $($HOME/Bin/make-screenshot-path)
# all outputs
bindsym $mod+Shift+p exec grim $($HOME/Bin/make-screenshot-path)

# exit sway
bindsym $mod+Shift+e exec "swaynag -t warning -m 'Exit?' -b 'Yes' 'swaymsg exit'""
# power menu
bindsym $mod+Shift+m exec "$HOME/Bin/powermenu.sh"

# resize window (you can also use the mouse for that)
mode "resize" {

        bindsym Shift+h resize shrink width 25 px or 16 ppt
        bindsym Shift+j resize grow height 25 px or 16 ppt
        bindsym Shift+k resize shrink height 25 px or 16 ppt
        bindsym Shift+l resize grow width 25 px or 16 ppt

        bindsym h resize shrink width 5 px or 4 ppt
        bindsym j resize grow height 5 px or 4 ppt
        bindsym k resize shrink height 5 px or 4 ppt
        bindsym l resize grow width 5 px or 4 ppt

        bindsym 2 resize set width 50 ppt ; mode "default"
        bindsym 3 resize set width 33 ppt ; mode "default"
        bindsym 4 resize set width 25 ppt ; mode "default"
        bindsym 5 resize set width 20 ppt ; mode "default"

        bindsym Shift+2 resize set height 50 ppt ; mode "default"
        bindsym Shift+3 resize set height 33 ppt ; mode "default"
        bindsym Shift+4 resize set height 25 ppt ; mode "default"
        bindsym Shift+5 resize set height 20 ppt ; mode "default"

        bindsym f floating toggle

        bindsym Return mode "default"
        bindsym Escape mode "default"
}

bindsym $mod+r mode "resize"

# TODO: review
bar {
    status_command i3status-rs
    font pango:Ubuntu Medium 13
    position bottom
    workspace_buttons yes

    # tray_output primary
    # Changed using i3-style: https://github.com/acrisci/i3-style/tree/master/themes
    colors {
        # colors:                border  backgr. text    ind.
        # separator #928374
        separator #1d425b
        background #282828
        statusline #ebdbb2
        # focused_workspace #f76922 #282828 #b8b8b8
        focused_workspace #3a86b7 #282828 #b8b8b8
        active_workspace #1d2021 #1d2021 #928374
        inactive_workspace #32302f #32302f #928374
        urgent_workspace #cc241d #cc241d #ebdbb2
    }
}

# Lock screen
bindsym $mod+Shift+o exec $HOME/Bin/sway_lock_screen

# # Start idle manager
# exec swayidle -w \
#     timeout 300 '$HOME/Bin/sway_lock_screen' \
#         resume 'swaymsg "output * dpms on"' \
#     timeout 600 'swaymsg "output * dpms off"' \
#         resume 'swaymsg "output * dpms on"' \
#     before-sleep '$HOME/Bin/sway_lock_screen'

### # background
### output "*" background $HOME/.dotfiles/wallpapers/alaska.jpg fill


### # Start mako for notifications
### exec mako &


### # Start clipboard manager
### exec wl-paste -t text --watch clipman store
### # exec wl-paste -p -t text --watch clipman store --histpath="~/.local/share/clipman-primary.json
### bindsym $mod+c exec clipman pick -t rofi
### # bindsym $win+c exec clipman pick -t rofi --histpath="~/.local/share/clipman-primary.json


### # Flash windows
### exec_always flashfocus
### bindsym $mod+n exec --no-startup-id flash_window

set $volpipe /tmp/volume.pipe
exec mkfifo $volpipe && tail -f $volpipe | wob

set $bripipe /tmp/brightness.pipe
exec mkfifo $bripipe && tail -f $bripipe | wob

# set volume to 30% on start
exec "sleep 5; $HOME/Bin/volume set 30"

# increase sound volume
bindsym XF86AudioRaiseVolume exec "$HOME/Bin/volume up >/tmp/volume.pipe"
# decrease sound volume
bindsym XF86AudioLowerVolume exec "$HOME/Bin/volume down >/tmp/volume.pipe"
# mute sound
bindsym XF86AudioMute exec "$HOME/Bin/volume toggle >/tmp/volume.pipe"
# toggle microphone capture
bindsym $mod+XF86AudioMute exec "amixer set Capture toggle"
# mute microphone
bindsym $mod+XF86AudioLowerVolume exec "amixer set Capture nocap"
# unmute microphone
bindsym $mod+XF86AudioRaiseVolume exec "amixer set Capture cap"
# change input source to headset mic
bindsym $mod+m exec "$HOME/Bin/mic"

# Increase screen brightness
bindsym XF86MonBrightnessUp exec "$HOME/Bin/brightness up >/tmp/brightness.pipe"
# Decrease screen brightness
bindsym XF86MonBrightnessDown exec "$HOME/Bin/brightness down >/tmp/brightness.pipe"

# Control audio playback
bindsym XF86AudioPlay exec "playerctl play-pause"
bindsym XF86AudioNext exec "playerctl next"
bindsym XF86AudioStop exec "playerctl stop"

# Battery monitor bot
exec "sleep 60 ; $HOME/Build/batbottg/bin/batbottg -c $HOME/.batbottg.ini >/tmp/batbottg.log"

# Update wifi networks list
exec "sleep 10 ; $HOME/Bin/networks.sh update"
# Connect to a listed network
bindsym $mod+n exec "$HOME/Bin/networks.sh list | $rofi --dmenu -p wifi | xargs $HOME/Bin/networks.sh connect"

# Notifications
for_window [title="^xfce4-notifyd$"] floating enable, sticky enable, border none, move position 20 20

# Zoom
for_window [app_id="^zoom$"] floating enable

# Start flashfocus
exec flashfocus

# Touchpad extra gestures
exec fusuma


# Add marvin task
# TODO: move the script to ./bin/
bindsym $mod+a exec /home/tomasz/Dev/Personal/marvin-client/venv/bin/python /home/tomasz/Dev/Personal/marvin-client/add_task.py "$(wofi --show dmenu --prompt "Task:" --lines 1)"

# colors

# classes:
# client.focused:           The window that has focus.
# client.focused_inactive:  The most recently focused view within a container which is not focused.
# client.placeholder:       Ignored (present for i3 compatibility).
# client.unfocused:         A view that does not have focus.
# client.urgent:            A view with an urgency hint.
#
# colors:
# border:        The border around the title bar.
# background:    The background of the title bar.
# text:          The text color of the title bar.
# indicator:     The color used to indicate where a new view will open. In a tiled container, this would paint the right border of the current view if a new view would be
# child_border:  The border around the view itself.

#class                   border     background  text       indicator  child_border
# client.focused           #3a86b7ff  #1d425baa   #ffffff    #ffffff77
client.focused           #1d425b #3a86b7aa #ffffff #3a86b7ff
# client.focused_inactive  #1d425baa  #00699488   #ffffff
client.focused_inactive  #1d425b #1d425aab #aaaaaa
# client.unfocused         #55555588  #55555588   #aaaaaa88
client.unfocused         #222222  #222222aa  #aaaaaa
